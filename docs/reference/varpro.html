<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Model-Independent Variable Selection via the Rule-based Variable Priority (VarPro) — varpro • Model-Independent Variable Selection with Variable Priority</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Model-Independent Variable Selection via the Rule-based Variable Priority (VarPro) — varpro"><meta property="og:description" content="Model-Independent Variable Selection via the Rule-based Variable Priority (VarPro)
for Regression, Classification and Survival."><meta property="og:image" content="https://www.randomforestsrc.org/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-WZWXVK817Z"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WZWXVK817Z');
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Model-Independent Variable Selection with Variable Priority</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.63</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/getstarted.html">
    <span class="fas fa-home fa-lg"></span>

    Getting Started
  </a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/speedup.html">Speedup VarPro Analyses</a>
    </li>
    <li>
      <a href="../articles/survival.html">Survival Problems</a>
    </li>
    <li>
      <a href="../articles/unsupervise.html">Unsupervised Problems</a>
    </li>
    <li>
      <a href="../articles/ivarpro.html">Individual Variable Priority (iVarPro)</a>
    </li>
    <li>
      <a href="../articles/partialpro.html">Partial Effects</a>
    </li>
    <li>
      <a href="../articles/isopro.html">Identify Anomalous Data</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Manual</a>
</li>
<li>
  <a href="https://github.com/kogalur/varPro/issues" class="external-link">Bug Reporting</a>
</li>
<li>
  <a href="https://github.com/kogalur/varPro/discussions" class="external-link">Discussions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/kogalur/varPro/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

    GitHub
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/kogalur/varPro/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

    GitHub
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Model-Independent Variable Selection via the Rule-based Variable Priority (VarPro)</h1>

    <div class="hidden name"><code>varpro.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Model-Independent Variable Selection via the Rule-based Variable Priority (VarPro)
for Regression, Classification and Survival.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">varpro</span><span class="op">(</span><span class="va">f</span>, <span class="va">data</span>, nvar <span class="op">=</span> <span class="fl">30</span>, ntree <span class="op">=</span> <span class="fl">500</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       split.weight <span class="op">=</span> <span class="cn">TRUE</span>, split.weight.method <span class="op">=</span> <span class="cn">NULL</span>, sparse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       nodesize <span class="op">=</span> <span class="cn">NULL</span>, max.rules.tree <span class="op">=</span> <span class="fl">150</span>, max.tree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">150</span>, <span class="va">ntree</span><span class="op">)</span>,</span>
<span>       parallel <span class="op">=</span> <span class="cn">TRUE</span>, cores <span class="op">=</span> <span class="fu">get.number.cores</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       papply <span class="op">=</span> <span class="va">mclapply</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, seed <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<p></p>
<dl><dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>Formula describing the model to be fit.</p></dd>


  <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Training data set (a data frame).</p></dd>


  <dt id="arg-nvar">nvar<a class="anchor" aria-label="anchor" href="#arg-nvar"></a></dt>
<dd><p>Upper limit to number of variables returned.</p></dd>


  <dt id="arg-ntree">ntree<a class="anchor" aria-label="anchor" href="#arg-ntree"></a></dt>
<dd><p>Number of trees to grow.</p></dd>


  <dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>Users can replace the original response value with their own
  custom designed response: for example this can be the predicted value
  from a machine learning method.  Used to study which variables are
  important in the user's predictor.  The supplied <code>y</code> must match
  the dimension of the data.</p></dd>


  <dt id="arg-split-weight">split.weight<a class="anchor" aria-label="anchor" href="#arg-split-weight"></a></dt>
<dd><p>Use guided tree-splitting?  Features selected to
  split a tree node are selected with probability according to a
  split-weight value, the latter by default being acquired in a
  preliminary lasso+tree step.</p></dd>


  <dt id="arg-split-weight-method">split.weight.method<a class="anchor" aria-label="anchor" href="#arg-split-weight-method"></a></dt>
<dd><p>Optional character string (or vector)
  specifying the method used to generate the split-weights.  If not
  specified, defaults to a lasso+tree step.  See details below.</p></dd>


  <dt id="arg-sparse">sparse<a class="anchor" aria-label="anchor" href="#arg-sparse"></a></dt>
<dd><p>Use sparse split-weights?</p></dd>


  <dt id="arg-nodesize">nodesize<a class="anchor" aria-label="anchor" href="#arg-nodesize"></a></dt>
<dd><p>Nodesize of trees. If not specified, value is set
  using an internal function optimized for sample size and dimension.</p></dd>


  <dt id="arg-max-rules-tree">max.rules.tree<a class="anchor" aria-label="anchor" href="#arg-max-rules-tree"></a></dt>
<dd><p>Maximum number of rules per tree.</p></dd>


  <dt id="arg-max-tree">max.tree<a class="anchor" aria-label="anchor" href="#arg-max-tree"></a></dt>
<dd><p>Maximum number of trees used for extracting rules.</p></dd>


  <dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>If <code>TRUE</code>, use parallel foreach to fit each lasso
  fold.  This registers parallel before hand using <code class="command">doMC</code>.</p></dd>


   <dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>Sets the number of cores for parallel processing when
     using the lasso.  By default uses the parallel command
     <code class="command">detectCores</code>.</p></dd>


  <dt id="arg-papply">papply<a class="anchor" aria-label="anchor" href="#arg-papply"></a></dt>
<dd><p>Use mclapply or lapply.</p></dd>


  <dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Print verbose output?</p></dd>


  <dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Seed for repeatability.</p></dd>


  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments (for experts only).</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>


<p>Rule-based models, such as simple decision rules, rule learning,
  trees, boosted trees, Bayesian additive regression trees, Bayesian
  forests and random forests, are widely used for variable
  selection. These nonparametric models do not require model
  specification and accommodate various outcomes including regression,
  classification, survival and longitudinal analyses. Although
  permutation variable importance (VIMP) and knockoffs have been
  extensively studied, their empirical results can be compromised in
  certain scenarios because both VIMP and knockoffs depend on the
  quality of the generated artificial covariates for their success. To
  address this practical problem, we propose a new framework of variable
  priority (VarPro), which instead of generating artificial covariates,
  creates release rules to examine the affect on the response for each
  covariate. Instead of new data being created, neighborhoods of the
  existing data are used for estimating the importance of a
  variable. Similar to VIMP and knockoffs, VarPro allows the conditional
  distribution of the response variable to be arbitrary and unknown.</p>
<p>The VarPro algorithm is described as follows.  A collection of
  <code>ntree</code> trees are grown with guided tree-splitting where
  variables selected to split a node are chosen with probability
  according to a split-weight obtained in a pre-processing step.  A
  random subset of <code>max.tree</code> trees are selected from the
  <code>ntree</code> trees and a random subset of branches,
  <code>max.rules.tree</code>, are chosen from each tree.  These rules are
  used for forming the VarPro estimator of importance.  Applies to
  regression, multiclass and survival data.</p>
<p>Guided tree-splitting encourages the rules harvested from a tree to
  favor potentially strong features.  Therefore option
  <code>split.weight</code> should generally be left on (this is especially
  true for high-dimensional problems).  If the option is turned off,
  consider increasing <code>nodesize</code> to improve precision of the
  estimators.</p>
<p>By default, split-weights are obtained by using a combination of lasso
  and trees.  The split-weight of a variable is defined as the
  absolute value of the standardized beta coefficient from fitting a
  lasso combined with the split frequency of the variable from a forest
  of shallow trees.  If the sample size is moderate and dimension is
  moderate then this latter step is replaced with the absolute value of
  the permutation importance of the variable.  Note that in order to use
  lasso for guided feature selection, factors are converted using
  one-hot-encoding.  Therefore all variables are converted to real
  values.</p>
<p>For greater customization of how split-weights are determined, use
  option <code class="command">split.weight.method</code> which is set by choosing any
  values from the strings "lasso", "tree", "vimp".  Thus "lasso" uses
  lasso only for determining the split-weight, whereas "lasso tree" or
  "lasso vimp" uses lasso in combination with shallow trees or lasso in
  combination with permutation importance.  See the examples below.</p>
<p>Selection of variables is based on a preset cutoff value set using the
  <code>importance</code> function.  There is a cross-validation (CV) method
  to automate this.  See <code class="command">cv.varpro</code>.</p>
<p>Run times can be improved by using smaller values of <code>ntree</code> and
  larger values of <code>nodesize</code>.  Other options are also available.
  See the examples below.</p>
<p>For class imbalanced settings (two class problems where relative
  frequency of labels is skewed towards one class) the code
  automatically switches to random forest quantile classification (RFQ;
  see O'Brien and Ishwaran, 2019) under the gmean (geometric mean)
  performance metric.  This can be over-ridden by the hidden option
  <code>use.rfq</code>.</p>



    </div>
    <div id="value">
    <h2>Value</h2>


<p>Output containing VarPro estimators used to calculate importance. See
  <code class="command">importance.varpro</code>.  Also see <code class="command">cv.varpro</code> for
  automated variable selection.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Min Lu and Hemant Ishwaran</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Lu M. and Ishwaran H. (2022).  Model-Independent Variable Selection
  via the Rule-based Variable Priority (VarPro).</p>
<p>O'Brien R. and Ishwaran H. (2019).  A random forests quantile
  classifier for class imbalanced data. <em>Pattern Recognition</em>,
  90, 232-249.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code class="command"><a href="glioma.html">glioma</a></code>
  <code class="command"><a href="cv.varpro.html">cv.varpro</a></code>
  <code class="command"><a href="importance.varpro.html">importance.varpro</a></code>
  <code class="command"><a href="predict.varpro.html">predict.varpro</a></code>
  <code class="command"><a href="isopro.varpro.html">isopro.varpro</a></code>
  <code class="command"><a href="unsupv.varpro.html">unsupv.varpro</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## classification example: iris </span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## apply varpro to the iris data</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## call the importance function and print the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## regression example: boston housing</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">BostonHousing</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## call varpro</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>, <span class="va">BostonHousing</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## extract and print importance values</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## another way to extract and print importance values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">get.vimp</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">get.vimp</a></span><span class="op">(</span><span class="va">o</span>, pretty <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## plot importance values</span></span>
<span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span>, plot.it <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## regression example: boston housing illustrating hot-encoding</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">BostonHousing</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## convert some of the features to factors</span></span>
<span><span class="va">Boston</span> <span class="op">&lt;-</span> <span class="va">BostonHousing</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">zn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">zn</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">chas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">chas</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">lstat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">0.2</span> <span class="op">*</span> <span class="va">Boston</span><span class="op">$</span><span class="va">lstat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">nox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">20</span> <span class="op">*</span> <span class="va">Boston</span><span class="op">$</span><span class="va">nox</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">rm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## call varpro and print the importance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>, <span class="va">Boston</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## get top variables</span></span>
<span><span class="fu"><a href="importance.varpro.html">get.topvars</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## map importance values back to original features</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">get.orgvimp</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## same as above ... but for all variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">get.orgvimp</a></span><span class="op">(</span><span class="va">o</span>, pretty <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## regression example: friedman 1</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">mlbench</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.friedman1.html" class="external-link">mlbench.friedman1</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## example without guided tree-splitting</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">mlbench</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.friedman2.html" class="external-link">mlbench.friedman2</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            nodesize <span class="op">=</span> <span class="fl">10</span>, split.weight <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## regression example: all noise</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">50</span><span class="op">)</span>, <span class="fl">100</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># \donttest{</span></span>
<span><span class="co">##----------------------------------------------------------------</span></span>
<span><span class="co">##  class imbalanced problem </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - simulation example using the caret R-package</span></span>
<span><span class="co">## - creates imbalanced data by randomly sampling the class 1 values</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##----------------------------------------------------------------</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/topepo/caret/" class="external-link">"caret"</a></span>, logical.return <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co">## experimental settings</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5000</span></span>
<span>  <span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span>  <span class="va">ir</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="co">## simulate the data, create minority class data</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">twoClassSim</span><span class="op">(</span><span class="va">n</span>, linearVars <span class="op">=</span> <span class="fl">15</span>, noiseVars <span class="op">=</span> <span class="va">q</span><span class="op">)</span></span>
<span>  <span class="va">d</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">idx.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">idx.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="va">ir</span> , replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">idx.0</span>,<span class="va">idx.1</span><span class="op">)</span>,, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="co">## varpro call</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="fu">varpro</span><span class="op">(</span><span class="va">f</span>, <span class="va">d</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## survival example: pbc </span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pbc</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">days</span>, <span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>, <span class="va">pbc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## pbc survival with rmst (restricted mean survival time)</span></span>
<span><span class="co">## functional of interest is RMST at 500 days</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pbc</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">days</span>, <span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>, <span class="va">pbc</span>, rmst <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## pbc survival with rmst vector</span></span>
<span><span class="co">## variable importance is a list for each rmst value</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pbc</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">days</span>, <span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>, <span class="va">pbc</span>, rmst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## survival example with more variables</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">peakVO2</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">ttodead</span>, <span class="va">died</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>, <span class="va">peakVO2</span><span class="op">)</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span>, plot.it <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## high dimensional survival example</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vdv</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Censoring</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>, <span class="va">vdv</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## high dimensional survival example without sparse option</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vdv</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Censoring</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>, <span class="va">vdv</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ----------------------------------------------------------------------</span></span>
<span><span class="co">## high dimensional survival example using different split-weight methods</span></span>
<span><span class="co">## ----------------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vdv</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Censoring</span><span class="op">)</span><span class="op">~</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## lasso only</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="fu">varpro</span><span class="op">(</span><span class="va">f</span>, <span class="va">vdv</span>, split.weight.method <span class="op">=</span> <span class="st">"lasso"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## lasso and vimp</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="fu">varpro</span><span class="op">(</span><span class="va">f</span>, <span class="va">vdv</span>, split.weight.method <span class="op">=</span> <span class="st">"lasso vimp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## lasso, vimp and shallow trees</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="fu">varpro</span><span class="op">(</span><span class="va">f</span>, <span class="va">vdv</span>, split.weight.method <span class="op">=</span> <span class="st">"lasso vimp tree"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## largish data (iowa housing data)</span></span>
<span><span class="co">## to speed up calculations convert data to all real</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## first we roughly impute the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">housing</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span><span class="va">dta</span> <span class="op">&lt;-</span> <span class="fu">randomForestSRC</span><span class="fu">:::</span><span class="fu">get.na.roughfix</span><span class="op">(</span><span class="va">housing</span><span class="op">)</span></span>
<span><span class="va">dta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html" class="external-link">data.matrix</a></span><span class="op">(</span><span class="va">dta</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## varpro call</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">SalePrice</span><span class="op">~</span><span class="va">.</span>, <span class="va">dta</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## large data: illustrates different ways to improve speed</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">25000</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## use large nodesize</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>, <span class="va">d</span>, ntree <span class="op">=</span> <span class="fl">100</span>, nodesize <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## use large nodesize, smaller bootstrap </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">.</span>, <span class="va">d</span>, ntree <span class="op">=</span> <span class="fl">100</span>, nodesize <span class="op">=</span> <span class="fl">200</span>,</span>
<span>           sampsize <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## custom split-weights (hidden option)</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">BostonHousing</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## make some features into factors</span></span>
<span><span class="va">Boston</span> <span class="op">&lt;-</span> <span class="va">BostonHousing</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">zn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">zn</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">chas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">chas</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">lstat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">0.2</span> <span class="op">*</span> <span class="va">Boston</span><span class="op">$</span><span class="va">lstat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">nox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">20</span> <span class="op">*</span> <span class="va">Boston</span><span class="op">$</span><span class="va">nox</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">rm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## get default custom split-weights: a named real vector</span></span>
<span><span class="va">swt</span> <span class="op">&lt;-</span> <span class="fu">varPro</span><span class="fu">:::</span><span class="fu">get.splitweight.custom</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>,<span class="va">Boston</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## define custom splits weight</span></span>
<span><span class="va">swt</span> <span class="op">&lt;-</span> <span class="va">swt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"crim"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">swt</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"zn"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">swt</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"nox"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">swt</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"rm"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">swt</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"lstat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">swt</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>           </span>
<span><span class="va">swt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"nox"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">swt</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">swt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"lstat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">swt</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span></span>
<span><span class="va">swt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">swt</span>, strange<span class="op">=</span><span class="fl">99999</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"custom split-weight\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">swt</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co">## call varpro with the custom split-weights</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>,<span class="va">Boston</span>,split.weight.custom<span class="op">=</span><span class="va">swt</span>,verbose<span class="op">=</span><span class="cn">T</span>,sparse<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"varpro result\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">get.vimp</a></span><span class="op">(</span><span class="va">o</span>, pretty<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">get.orgvimp</a></span><span class="op">(</span><span class="va">o</span>, pretty<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## user supplied y </span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">BostonHousing</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## train your ML method here - we use misspecified linear model</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">lstat</span><span class="op">+</span><span class="va">b</span>, <span class="va">BostonHousing</span><span class="op">)</span><span class="op">$</span><span class="va">fitted</span></span>
<span></span>
<span><span class="co">## varpro with user specified y</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">varpro</span><span class="op">(</span><span class="va">medv</span><span class="op">~</span><span class="va">.</span>, <span class="va">BostonHousing</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="importance.varpro.html">importance</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># }</span></span></code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://www.luminwin.net" class="external-link">Min Lu</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

